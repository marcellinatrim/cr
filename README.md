# Pavuk Crawler

Этот репозиторий содержит рефакторинг краулера `pavuk5_refactored.go`. Скрипт можно собрать и запустить без внешних Go-зависимостей.

## Требования

- Go 1.24+
- Доступ на запись к каталогам, указанным в конфиге (`./data/queue`, `./data/checkpoint`, `./data/output` по умолчанию).

## Сборка

По умолчанию команда `go` может попытаться загрузить недостающий toolchain (Go 1.25). Чтобы избежать сетевых запросов в изолированной среде, воспользуйтесь локальным toolchain:

```bash
export GOTOOLCHAIN=local
```

После этого выполните сборку:

```bash
go build ./...
```

При успешной сборке бинарник `pavuk` появится в корне репозитория.

## Запуск

Бинарник принимает флаги, которые отражают поля конфигурации. Для запуска с параметрами по умолчанию:

```bash
./pavuk
```

Чтобы посмотреть доступные флаги:

```bash
./pavuk --help
```

Перед запуском убедитесь, что каталоги из конфигурации существуют (программа создаёт их автоматически при инициализации).

## Выходные данные

- `data/output/findings.jsonl` — результаты в формате JSONL.
- `data/output/tier{1-4}.txt` — списки URL по Tier.
- `data/queue/` и `data/checkpoint/` — рабочие директории очереди и снимков состояния.

## Отладка и диагностика

- Логи по умолчанию выводятся в текстовом формате. Изменить формат можно флагом `--log-json`.
- Для корректного завершения предусмотрена обработка `SIGINT`/`SIGTERM`: при нажатии `Ctrl+C` краулер вызовет `Shutdown()` и запишет финальные снапшоты.
- В случае проблем с кодировкой HTML тело ответа конвертируется в UTF-8 для распространённых однобайтовых кодировок (`latin1`, `windows-1251/1252`, `koi8-r`).

## Быстрый старт

```bash
export GOTOOLCHAIN=local
mkdir -p data/queue data/checkpoint data/output
go run ./pavuk5_refactored.go --help
```

Эти команды позволят убедиться, что скрипт запускается и выводит справку без необходимости загружать внешние пакеты.
